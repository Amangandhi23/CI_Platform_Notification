@{
    ViewData["Title"] = "Story Detail Page";
    Layout = "";
}

@model CI_Platform.Entities.ViewModel.StoryModel;


<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/site2.css">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <style>
        #paragraph-container {
            position: relative;
        }

        #paragraph {
            white-space: pre-wrap;
            font-family: Arial;
            font-size: 16px;
            line-height: 1.5;
        }

        #scrollbar-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background-color: red;
            transform-origin: left;
        }

        .ImageCarousel {
            width: 100%;
            height: 75%;
        }
    </style>

</head>

<body>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    @*<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>*@

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    <partial name="_Notification" />
    <!-- 1) HEADER -->


    <nav class="navbar navbar-expand-md navbar-light border-bottom">
        <div class="container">
            <div class="d-flex d-block d-md-none justify-content-between">
                <div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon "></span>
                    </button>
                </div>
                <div>
                    <img src="@Model.User.FirstOrDefault(m => m.UserId == @Model.UserId).Avatar" alt="mdo" width="40" height="40"
                         class="rounded-circle img12">
                </div>
            </div>


            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav  me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active link-dark" aria-current="page" asp-controller="Story" asp-action="Story">Stories</a>
                    </li>
                    <li class="nav-item dropdown ml-1">
                        <a class="nav-link dropdown-toggle link-dark" href="#" id="navbarDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            Policy
                        </a>
                        <ul class="dropdown-menu" id="Policypages" aria-labelledby="navbarDropdown">
                        </ul>
                    </li>


                </ul>
                <ul class="navbar-nav me-0 mb-2 mb-lg-0">


                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle link-dark" href="#" id="navbarDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            @{
                                var userdata = Model.User.FirstOrDefault(m => m.UserId == @Model.UserId);
                                var path = userdata.Avatar;
                                <img src="@path" alt="mdo" width="40" height="40"
                                     class="rounded-circle profile_pic">
                                <span>@userdata.FirstName @userdata.LastName</span>
                            }

                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" asp-controller="Profile" asp-action="UserProfile">Profile</a></li>
                            <li><a class="dropdown-item" asp-controller="Profile" asp-action="VolunteeringTimeSheet">Volunteering TimeSheet</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Logout">Sign out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>






    @*Img Content*@
    <div class="container">
        <div class="row">
            <div class="col-12 col-xl-6 d-flex flex-column">

                <!-- Full-width images with number text -->
                @{
                    if (Model.StoryMedium.Where(id => id.StoryId == @Model.StoryId).ToList().Count() > 0)
                    {
                        foreach (var item in Model.StoryMedium.Where(id => id.StoryId == @Model.StoryId))
                        {
                            if (item.Type == "PNG")
                            {
                    <div class="mySlides d-none img-fluid" style="height:420px">
                        <img src="@item.Path" class="mission-img">
                    </div>
                            }
                            else
                            {
                                string videostring = @item.Path.Replace("watch?v=", "embed/");
                                int GetURLlength = videostring.Length;

                                string pathcheck = videostring.Substring(13, 1);
                                if (pathcheck == ".")
                                {
                                    string GetURLValue = videostring.Substring(17);
                                    string YoutubeURL = "https://www.youtube.com/embed/" + GetURLValue + "?rel=0";
                    <div class="mySlides d-none" style="height:380px">
                        <iframe class="img-fluid demo h-100" src="@YoutubeURL">
                        </iframe>
                    </div>
                                }
                                else
                                {
                                                        <div class="mySlides d-none" style="height:380px">
                                                            <iframe class="img-fluid demo h-100" src="@item.Path.Replace("watch?v=", "embed/")" allowfullscreen>
                                                            </iframe>
                                                        </div>
                                }
                            }
                        }
                }
                else
                {
                <div class="mySlides d-none img-fluid" style="height:420px">
                    <img src="~/Assest/CSR-initiative-stands-for-Coffee--and-Farmer-Equity-2.png" class="mission-img">
                </div>
                }

                }




                <!-- Thumbnail images -->
                <div id="recipeCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner" role="listbox">

                        @{
                            int mediacount = 1;
                        }
                        @foreach (var item in Model.StoryMedium.Where(id => id.StoryId == @Model.StoryId))
                        {
                            if (mediacount == 1)
                            {
                                if (item.Type == "PNG")
                                {
                        <div class="carousel-item active">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-img">
                                        <img src="@item.Path"
                                             class="img-fluid cursor demo" onclick="currentSlide(@mediacount)">
                                    </div>
                                </div>
                            </div>
                        </div>
                                }
                                else
                                {
                        <div class="carousel-item active">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-img" style="position:relative;float:left;">
                                        @{
                                                        string videostring = @item.Path.Replace("watch?v=", "embed/");
                                                        int GetURLlength = videostring.Length;

                                                        string pathcheck = videostring.Substring(13, 1);
                                                        if (pathcheck == ".")
                                                        {
                                                            string GetURLValue = videostring.Substring(17);
                                                            string YoutubeURL = "https://www.youtube.com/embed/" + GetURLValue + "?rel=0";
                                            <iframe class="img-fluid demo" src="@YoutubeURL"></iframe>
                                            <div class="overlay d-md-block d-none" style="top:0;left:0;width:100%;height:100%;position:absolute;" onclick="currentSlide(@mediacount)"></div>
                                        }
                                        else
                                        {
                                        <iframe class="img-fluid demo" src="@item.Path.Replace("watch?v=", "embed/")"></iframe>
                                        <div class="overlay d-md-block d-none" style="top:0;left:0;width:100%;height:100%;position:absolute;" onclick="currentSlide(@mediacount)"></div>
                                        }
                                        }



                                    </div>
                                </div>
                            </div>
                        </div>
                                }
                            }
                            else
                            {
                                if (item.Type == "PNG")
                                {
                        <div class="carousel-item">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-img">
                                        <img src="@item.Path" class="img-fluid cursor demo"
                                             onclick="currentSlide(@mediacount)">
                                    </div>
                                </div>
                            </div>
                        </div>
                                }
                                else
                                {
                        <div class="carousel-item">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-img" style="position:relative;float:left;">
                                        @{
                                                        string videostring = @item.Path.Replace("watch?v=", "embed/");
                                                        int GetURLlength = videostring.Length;

                                                        string pathcheck = videostring.Substring(13, 1);
                                                        if (pathcheck == ".")
                                                        {
                                                            string GetURLValue = videostring.Substring(17);
                                                            string YoutubeURL = "https://www.youtube.com/embed/" + GetURLValue + "?rel=0";
                                            <iframe class="img-fluid demo" src="@YoutubeURL"></iframe>
                                            <div class="overlay d-md-block d-none" style="top:0;left:0;width:100%;height:100%;position:absolute;" onclick="currentSlide(@mediacount)"></div>
                                        }
                                        else
                                        {
                                        <iframe class="img-fluid demo" src="@item.Path.Replace("watch?v=", "embed/")"></iframe>
                                        <div class="overlay d-md-block d-none" style="top:0;left:0;width:100%;height:100%;position:absolute;" onclick="currentSlide(@mediacount)"></div>
                                        }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                                }
                            }
                            mediacount++;
                        }
                    </div>
                    <a class="carousel-control-prev bg-transperent w-auto" href="#recipeCarousel" role="button"
                       data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    </a>
                    <a class="carousel-control-next bg-transperent w-auto" href="#recipeCarousel" role="button"
                       data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    </a>
                </div>

            </div>



            <!-- for img js code -->
            <script>
                //function display(item) {
                // let image = document.getElementById("image-area");
                // image.src = item.src;
                // }

                let slideIndex = 1;
                showSlides(slideIndex);

                // Thumbnail image controls
                function currentSlide(n) {
                    showSlides(slideIndex = n);
                }

                function showSlides(n) {
                    let slides = document.getElementsByClassName("mySlides");
                    for (i = 0; i < slides.length; i++) {
                        slides[i].classList.replace("d-sm-block", "d-none");
                    }
                    slides[slideIndex - 1].classList.add("d-sm-block");
                }

                let items = document.querySelectorAll(".carousel .carousel-item");

                items.forEach((el) => {
                    const minPerSlide = 4;
                    let next = el.nextElementSibling;
                    for (var i = 1; i < minPerSlide; i++) {
                        if (!next) {
                            // wrap carousel by using first child
                            next = items[0];
                        }
                        let cloneChild = next.cloneNode(true);
                        el.appendChild(cloneChild.children[0]);
                        next = next.nextElementSibling;
                    }
                });
            </script>


            <div class="col-12 col-xl-6 mt-3 ml-2 mt-3">

                <div>
                    @{
                        var path1 = @Model.User.FirstOrDefault(m => m.UserId == Model.storyuserid).Avatar;
                        <img src="@path1" style="border-radius:100%; margin:20px;" />
                    }
                    <div class="d-flex justify-content-between align-items-center text-center">
                        <span class="p-2" style="margin-left:20px;">@Model.User.FirstOrDefault(m => m.UserId == Model.storyuserid).FirstName @Model.User.FirstOrDefault(m => m.UserId == Model.UserId).LastName</span>
                        <div class="border border-1 rounded-pill pe-3 py-2">
                            <img src="~/Assest/eye.png" class="ps-3" alt="">
                            <span class="p-1">
                                @Model.Stories.FirstOrDefault(m => m.StoryId == Model.StoryId).Views views
                            </span>
                        </div>
                    </div>
                </div>



                <p class="mt-4">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
                    dolore magna aliqua. Ut enim ad minim veniam. Sed ut perspiciatis unde omnis iste natus error sit voluptatem
                    accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore. Lorem ipsum dolor
                    sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut
                    enim ad minim veniam. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque
                    laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore.
                </p>


                <div class="row">
                    <div class="col-12 col-md-6 justify-content-start w-60" style="margin-bottom:15px;">
                        <button type="button" class="btn btn-outline-info btn_border_1  h-auto" data-bs-toggle="modal" data-bs-target="#recommended">
                            <img src="~/Assest/add1.png" class=" " alt="right-arrow">
                            Recommend to a Co-Worker
                        </button>
                    </div>
                    <div class="col-12 col-md-6 justify-content-start w-40">
                        <a asp-controller="Mission" asp-action="Volunteering" asp-route-id="@Model.Stories.FirstOrDefault(m => m.StoryId == Model.StoryId).MissionId" class="btn btn-outline-primary btn_border_1  h-auto" style="background: #F8863400 0% 0% no-repeat padding-box;border: 2px solid #F88634;color: #F88634;">
                            Open Mission
                            <img src="~/Assest/right-arrow.png" class=" " alt="right-arrow">
                        </a>
                    </div>
                </div>


            </div>


        </div>
    </div>

    <div class="container">
        <div class="row" id="paragraph-container">
            <div class="col-12 pt-2" style="font-size: 30px;color: black; margin-top:20px;">
                @Model.Stories.FirstOrDefault(m => m.StoryId == Model.StoryId).Title
                <hr />
            </div>
            <div id="paragraph">
                @Html.Raw(Model.Stories.FirstOrDefault(m => m.StoryId == Model.StoryId).Description)
            </div>
            @*<div id="scrollbar-line"></div>*@
        </div>
    </div>



    <!-- Modal -->
    <div class="modal fade" id="recommended" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="exampleModalLabel">Recommend to a Co-Worker</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body container" style="overflow-y: auto;max-height: 350px;">
                    @foreach (var item in Model.User)
                    {
                     if (ViewBag.id != item.UserId && item.Role != "Admin" && item.DeletedAt == null && item.Status == "1")
                        {
                    <div class="d-flex justify-content-between border-bottom">
                        <div class="mb-2">
                            <img src="@item.Avatar" style="border-radius: 100%; width:40px; height:40px;" />
                            <span>@item.FirstName @item.LastName</span>

                        </div>
                        <div>
                            <button type="button" class="btn btn-outline-primary pt-1 recomforstory" value="@Model.StoryId @item.UserId @Model.UserId @item.Email">Invite</button>
                        </div>
                    </div>

                        }

                    }
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>



    <footer class="border-top mt-3 footer text-muted">
        <div class="container d-flex align-items-center justify-content-start gap-3">
            &copy; 2023 - CI-Platform

            <a asp-controller="Policy" asp-action="PolicyPage" class="btn" style="color:blue">
                Policy
            </a>
        </div>
    </footer>
    @*<script src="~/js/storydetail.js" ></script>*@
    <script>

        $('.recomforstory').on('click', function () {
            var invite = $(this).val();
            var arr = invite.split(" ");

            var recommend = {
                StoryId: arr[0],
                UserId: arr[1],
                FromUserId: arr[2],
                UserEmail: arr[3]
            }

            url1 = "/Story/Recommandation?recommend=" + JSON.stringify(recommend);

            $.ajax({
                url: url1,
                success: function (data) {
                    toastr.success("Email has been sent to your Co-Worker");
                    $("#recommended").modal("hide");
                }
            });

            console.log(recommend);
        });
    </script>

    <script>

        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "/Policy/CmsPagePolicy",
                data: {},
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    var policy = " ";
                    for (var i = 0; i < data.length; i++) {
                        policy += `<li><a class="dropdown-item" href="/Policy/PolicyPage#${data[i].slug}">${data[i].title}</a></li>`
                    }
                    $("#Policypages").html(policy);

                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    </script>
</body>
</html>














