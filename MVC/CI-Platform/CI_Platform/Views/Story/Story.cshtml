@using System.Web
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Story Listing Page";
    Layout = "";
}

@model CI_Platform.Entities.ViewModel.StoryModel;


<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/site2.css">
    <link rel="stylesheet" href="httpsrgb()n.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

    <!-- <link href="" rel="stylesheet"> -->
    @*<script>
        window.onload = function(){
        document.getElementById('For_rating').click();
        var rate = document.getElementById('currentRatings').value;
        for (var i = 1; i <= rate; i++) {
        $('#' + i + "two").css('display', 'block');
        $('#' + i + "one").css('display', 'none');
        }
        }
        </script>*@
</head>

<body>


    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    @*<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>*@

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>



    <partial name="_Notification" />

    <!-- 1) HEADER -->


    <nav class="navbar navbar-expand-md navbar-light border-bottom">
        <div class="container">
            <div class="d-flex d-block d-md-none justify-content-between">
                <div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon "></span>
                    </button>
                </div>
                <div>
                    
                    <img src="@Model.User.FirstOrDefault(m => m.UserId == @Model.UserId).Avatar" alt="mdo" width="40" height="40"
                         class="rounded-circle img12">
                </div>
            </div>


            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav  me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active link-dark" aria-current="page" asp-controller="Story" asp-action="Story">Stories</a>
                    </li>
                    <li class="nav-item dropdown ml-1">
                        <a class="nav-link dropdown-toggle link-dark" href="#" id="navbarDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            Policy
                        </a>
                        <ul class="dropdown-menu" id="Policypages" aria-labelledby="navbarDropdown">
                        </ul>
                    </li>


                </ul>
                <ul class="navbar-nav me-0 mb-2 mb-lg-0">


                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle link-dark" href="#" id="navbarDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            @{
                                var userdata = Model.User.FirstOrDefault(m => m.UserId == @Model.UserId);
                                var path1 = userdata.Avatar;
                                <img src="@path1" alt="mdo" width="40" height="40"
                                 class="rounded-circle profile_pic">
                                <span>@userdata.FirstName @userdata.LastName</span>
                            }
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" asp-controller="Profile" asp-action="UserProfile">Profile</a></li>
                            <li><a class="dropdown-item" asp-controller="Profile" asp-action="VolunteeringTimeSheet">Volunteering TimeSheet</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Logout">Sign out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>









    <!-- 2) Main content of story listing page -->


    <div class="container-fluid main_img sharestoryimagepreview">
        <img src="~/Assest/Grow-Trees-On-the-path-to-environment-sustainability-login-9.png" class="img_set" alt=""
             style="width:100%; height: 100%;">
        <div class="middle">
            <p class="text d-none d-md-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
                exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
            </p>
            <a class=" text btn border btn_share_story h-auto" asp-controller="Story" asp-action="Storylisting">Share your story</a>
        </div>

    </div>


    <!--3) cards details -->

    <div class="container mt-5">
        <div class="row">

            @foreach (var item in Model.Stories)
            {
                if (item.Status == "PUBLISHED")
                {

                    <div class="col-sm-12 col-md-6 col-lg-4 pt-3 story_card">
                        <div class="card" style="height:100%;">
                            <div class="img-container story-grid storyhoverClass" style="position: relative;">
                                @{
                                    var storymideaparticulardata = @Model.storymedia.FirstOrDefault(id => id.StoryId == @item.StoryId && id.Type == "PNG");
                                    if (@storymideaparticulardata != null)
                                    {
                                        var path = @Model.storymedia.FirstOrDefault(id => id.StoryId == @item.StoryId && id.Type == "PNG")?.Path;
                                        <img src="@path"
                                 class="card-img-top sharestoryimagepreview" alt="..." width="460" height="220">
                                    }
                                    else
                                    {
                                        <img src="~/Assest/emptyimage.png"
                                 class="card-img-top sharestoryimagepreview" alt="..." width="460" height="220">
                                    }

                                }
                                <div class="card-img-overlay viewstoryDiv">
                                    <a asp-controller="Story" asp-action="Storydetail" asp-route-storyid="@item.StoryId" style="position: relative;" class="gridview-btn btn h-auto">
                                        View
                                        Details
                                    </a>
                                </div>
                                <div style="position: absolute; bottom:0 ;width: 100%;">
                                    <p class="bg-white border rounded-pill text-center w-50"
                               style="transform: translate(50%,130%); font-size: smaller;">
                                        @{
                                            var Theme = Model.MissionTheme.First(m => m.MissionThemeId == item.Mission.ThemeId && item.Mission.MissionId == item.MissionId).Title;

                                            @Theme
                                        }

                                    </p>
                                </div>
                            </div>

                            <div class="card-body">
                                <h3 class="card-title" style="max-height:33%;overflow:hidden;">@item.Title</h3>
                                <p class="card-text" style="max-height:33%;overflow:hidden;">
                                    @Html.Raw(item.Description)
                                </p>
                                <div class="d-flex justify-content-between" style="max-height:33%;overflow:hidden;">
                                    <div class="d-flex ">
                                        <img src="@item.User.Avatar" style="border-radius: 100%;" width="50" height="50"
                                     alt="">
                                        <p style="padding-left: 15px; padding-top: 12px;">@item.User.FirstName @item.User.LastName</p>
                                    </div>
                                    <div>
                                        @if (@item.Status == "DRAFT")
                                        {
                                            <a asp-controller="Story" asp-action="Storylisting" asp-route-storyid="@item.StoryId" class="btn btn-primary btn_border">EditStory</a>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    if (item.UserId == @Model.UserId)
                    {
                        <div class="col-sm-12 col-md-6 col-lg-4 pt-3 story_card">
                            <div class="card" style="height:100%;">
                                <div class="img-container story-grid" style="position: relative;">
                                    @{
                                        var storymideaparticulardata = @Model.storymedia.FirstOrDefault(id => id.StoryId == @item.StoryId && id.Type == "PNG");
                                        if (@storymideaparticulardata != null)
                                        {
                                            var path = @Model.storymedia.FirstOrDefault(id => id.StoryId == @item.StoryId && id.Type == "PNG")?.Path;
                                            <img src="@path"
                                 class="card-img-top" alt="..." width="460" height="220">
                                        }
                                        else
                                        {
                                            <img src="~/Assest/emptyimage.png"
                                 class="card-img-top" alt="..." width="460" height="220">
                                        }

                                    }
                                    <div class="card-img-overlay">
                                        <a asp-controller="Story" asp-action="Storydetail" asp-route-storyid="@item.StoryId" style="position: relative;" class="gridview-btn btn h-auto">
                                            View
                                            Details
                                        </a>
                                    </div>
                                    <div style="position: absolute; bottom:0 ;width: 100%;">
                                        <p class="bg-white border rounded-pill text-center w-50"
                               style="transform: translate(50%,130%); font-size: smaller;">
                                            @{
                                                var Theme = Model.MissionTheme.First(m => m.MissionThemeId == item.Mission.ThemeId && item.Mission.MissionId == item.MissionId).Title;

                                                @Theme
                                            }

                                        </p>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <h3 class="card-title" style="max-height:33%;overflow:hidden;">@item.Title</h3>
                                    <p class="card-text" style="max-height:33%;overflow:hidden;">
                                        @Html.Raw(item.Description)
                                    </p>
                                    <div class="d-flex justify-content-between" style="max-height:33%;overflow:hidden;">
                                        <div class="d-flex ">
                                            <img src="@item.User.Avatar" style="border-radius: 100%;" width="50" height="50"
                                     alt="">
                                            <p style="padding-left: 15px; padding-top: 12px;">@item.User.FirstName @item.User.LastName</p>
                                        </div>
                                        <div>
                                            @if (@item.Status == "DRAFT")
                                            {
                                                <a asp-controller="Story" asp-action="Storylisting" asp-route-storyid="@item.StoryId" class="btn btn-primary">EditStory</a>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }


            }
        </div>
    </div>

    <div class="d-flex justify-content-center mt-3">
        <nav aria-label="Page navigation example">
            <ul class="pagination">
                <li class="page-item">
                    <button class="page-link" id="prev-vol" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                        <span class="sr-only">Previous</span>
                    </button>
                </li>
                @*              <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>*@
                <li class="page-item">
                    <button class="page-link" id="next-vol" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                        <span class="sr-only">Next</span>
                    </button>
                </li>
            </ul>
        </nav>

    </div>

     <footer class="border-top mt-3 footer text-muted">
        <div class="container d-flex align-items-center justify-content-start gap-3" >
        &copy; 2023 - CI-Platform

            <a asp-controller="Policy" asp-action="PolicyPage" class="btn" style="color:blue" >
                Policy
            </a>
        </div>
    </footer>



    <script src="~/js/storydetail.js"></script>

    <script>

        $(document).ready(function(){
            $.ajax({
                type: "GET",
                url: "/Policy/CmsPagePolicy",
                data:{ },
                dataType:'json',
                success: function (data) {
                    console.log(data);
                    var policy=" ";
                    for(var i=0;i<data.length;i++){
                        policy+=`<li><a class="dropdown-item" href="/Policy/PolicyPage#${data[i].slug}">${data[i].title}</a></li>`
                    }
                    $("#Policypages").html(policy);

                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    </script>
</body>
</html>

